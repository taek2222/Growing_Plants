<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <title>GWNU 틔운</title>
  <style>
    .card {
      background: #FFF;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 1em;
      margin-bottom: 1em;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .image-selector {
      margin: 0 auto 1em auto;
      width: 60%;
      text-align: center;
    }
    .project-name {
      text-align: center;
      font-size: 32px; /* 원하는 크기로 조절 */
      font-weight: bold;
    }    
    .status-label {
      display: block;
      font-weight: bold;
      margin-bottom: 0.5em;
    }
    .status-bar {
      width: 100%;
      height: 20px;
      border-radius: 10px;
      background-color: #e0e0e0;
      margin-bottom: 0.5em;
    }
    .status-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 0.3s ease-in-out;
    }
    .soil-temperature .status-fill,
    .atmosphere-temperature .status-fill {
      background-color: #4caf50;
    }
    .soil-humidity .status-fill,
    .atmosphere-humidity .status-fill {
      background-color: #2196f3;
    }
    .environmental-data, .soil-data {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
    }
    .plant-photo{
      margin-right: 30px;
      margin-bottom: 2em;
    }
    .plant-photo img {
      width: 600px;
      height: auto;
      border-radius: 8px;
    }
    .soil-data {
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: space-around;
    }
    .soil-data .card, .atmosphere-data .card {
      margin-right: 1em; 
      width: 45%; 
      height: 45%; 
      padding: 0.5em; 
    }
    .temperature-display {
      display: flex; /* 요소를 나란히 배열 */
      align-items: center; /* 이미지와 텍스트를 중앙 정렬 */
      margin-bottom: 0.5em; /* 필요에 따라 조정 */
    }
    
    .thermometer {
      margin-right: 10px; /* 이미지와 텍스트 사이의 간격 조절 */
      width: 50px; /* 온도계 이미지의 너비 */
      height: auto; /* 이미지 높이는 자동으로 조절 */
    }
    
    .temperature-value {
      font-size: 20px; /* 온도 텍스트의 크기, 필요에 따라 조정 */
      font-weight: bold;
    }
    .ai{
      width: 5%;
    }
    .card{
      width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <header class="project-name">
    GWNU 틔운
  </header>
  <main class="container">
    <div class="grid">
      <div class="image-selector">
        <select id="image-selector" onchange="changeImage()">
          <option value="testimage.jpg">이미지1</option>
          <option value="testimage2.jpg">이미지2</option>
        </select>
      </div>
      <section class="environmental-data">
        <div class="plant-photo">
          <img id="plant-image" src="testimage.jpg" alt="식물 사진">
        </div>
        <div class="card weather">
            <span id="weather-data"> </span>
        </div>
      </section>
      <section class="soil-data">
        <div class="card atmosphere-temperature">
          <span class="status-label">대기 온도</span>
          <div class="temperature-display">
            <img src="대기온도.png" alt="온도계" class="thermometer">
            <span class="temperature-value">24°C</span>
          </div>
        </div>     
        <div class="card atmosphere-humidity">
          <span class="status-label">대기 습도</span>
          <div class="status-bar">
            <div class="status-fill" style="width: 80%;"></div>
          </div>
          <span class="status-label">80%</span>
        </div>
        <div class="card soil-temperature">
          <span class="status-label">조도 센서</span>
          <div class="temperature-display">
          </div>
        </div>
        <div class="card soil-humidity">
          <span class="status-label">토양 습도</span>
          <div class="status-bar">
            <div class="status-fill" style="width: 70%;"></div>
          </div>
          <span class="status-label">70%</span>
        </div>
        
      </section>
      <div class="card ai">
        <span class="ai-display">
          <img src="ai.png" alt="ai" class="ai">
          <span class="ai-text">현재 식물 상태를 나타내는 테스트 문구입니다.</span>
        </span>
      </div>
    </div>
  </main>
  <script>
    // 이미지 변경 함수
    function changeImage() {
      var selector = document.getElementById('image-selector');
      var image = document.getElementById('plant-image');
      image.src = selector.value;
    }

    // 기상청 API 엔드포인트
    const apiUrl = 'http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtNcst';

    // 서비스키 입력
    const serviceKey = 'UywwlFo1%2FAJ4cWclZif5LrQEPu41%2FADGWn3OOnPPAf0v5E%2Bkrt8OZiOpUU2RaJaLCSBqa9D6tBe3WFSICiI66g%3D%3D';

    // 날씨 데이터 카테고리 설명
    const categoryDescriptions = {
      PTY: '강수 형태',
      REH: '상대 습도',
      RN1: '1시간 강수량',
      T1H: '기온',
      UUU: '동서바람의 성분',
      VEC: '풍향',
      VVV: '남북바람의 성분',
      WSD: '풍속'
    };

    // 날짜와 시간 설정
    const now = new Date();
    const baseDate = now.toISOString().split('T')[0].replace(/-/g, '');
    const hours = now.getHours();
    const baseTime = (hours < 10 ? '0' : '') + (Math.floor(hours / 3) * 3).toString().padStart(2, '0') + '00';

    // 수정된 좌표 설정
    const params = `serviceKey=${serviceKey}&numOfRows=10&pageNo=1&base_date=${baseDate}&base_time=${baseTime}&nx=76&ny=122&dataType=JSON`;

    // API 호출 및 데이터 처리 함수
    async function fetchWeatherData() {
      try {
        const response = await fetch(`${apiUrl}?${params}`);
        if (!response.ok) {
          throw new Error('API 호출 실패');
        }
        const data = await response.json();
        updateWeatherCard(data);
      } catch (error) {
        console.error('날씨 정보를 불러오는 중 에러가 발생했습니다.', error);
      }
    }

    // weather card 업데이트 함수
    function updateWeatherCard(data) {
      const items = data.response.body.items.item;
      let weatherInfoHTML = '';
      items.forEach(item => {
        const description = categoryDescriptions[item.category] || '알 수 없는 카테고리';
        weatherInfoHTML += `${description}: ${item.obsrValue}<br>`;
      });
      document.getElementById('weather-data').innerHTML = weatherInfoHTML;
    }
    // 페이지 로드 시 날씨 데이터 가져오기
    document.addEventListener('DOMContentLoaded', fetchWeatherData);
  </script>
</body>
</html>
